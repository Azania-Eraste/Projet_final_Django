{% extends 'base/base.html' %}
{% load static %}

{% block header %}
<!-- Hero Section Begin -->
<section class="hero hero-normal">
    <div class="container">
        <div class="row">
            <div class="col-lg-3">
                <div class="hero__categories">
                    <div class="hero__categories__all">
                        <i class="fa fa-bars"></i>
                        <span>All departments</span>
                    </div>
                    <ul>
                        {% for categorie in Categories %}
                            <li><a href="#">{{ categorie.nom }}</a></li>   
                        {% endfor %}
                    </ul>
                </div>
            </div>
            <div class="col-lg-9">
                <div class="hero__search">
                    <div class="hero__search__form">
                        <form action="#">
                            <div class="hero__search__categories">
                                All Categories
                                <span class="arrow_carrot-down"></span>
                            </div>
                            <input type="text" placeholder="What do you need?">
                            <button type="submit" class="site-btn">SEARCH</button>
                        </form>
                    </div>
                    <div class="hero__search__phone">
                        <div class="hero__search__phone__icon">
                            <i class="fa fa-phone"></i>
                        </div>
                        <div class="hero__search__phone__text">
                            <h5>+65 11.188.888</h5>
                            <span>support 24/7 time</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
<!-- Hero Section End -->
{% endblock %}

{% block content %}
    <!-- Breadcrumb Section Begin -->
    <section class="breadcrumb-section set-bg" data-setbg="{% static 'img/breadcrumb.jpg' %}">
        <div class="container">
            <div class="row">
                <div class="col-lg-12 text-center">
                    <div class="breadcrumb__text">
                        <h2>Détail de la Commande #{{ commande.id }}</h2>
                        <div class="breadcrumb__option">
                            <a href="{% url 'blog:index' %}">Accueil</a>
                            <a href="{% url 'Ecommerce:commandes' %}">Mes Commandes</a>
                            <span>Détail</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Breadcrumb Section End -->

    <!-- Commande Detail Section Begin -->
    <section class="shoping-cart spad">
        <div class="container">
            <div class="row">
                <!-- Sidebar -->
                <div class="col-lg-3">
                    <div class="hero__categories">
                        <div class="hero__categories__all">
                            <i class="fa fa-bars"></i>
                            <span>Mon Compte</span>
                        </div>
                        <ul>
                            <li><a href="{% url 'Ecommerce:profile' %}">Profil</a></li>
                            <li class="active"><a href="{% url 'Ecommerce:commandes' %}">Mes Commandes</a></li>
                            <li><a href="{% url 'Ecommerce:favorite' %}">Mes Favoris</a></li>
                            <li><a href="{% url 'Ecommerce:paiement' %}">Mode de Paiement</a></li>
                        </ul>
                    </div>
                </div>

                <!-- Contenu principal -->
                <div class="col-lg-9">
                    <div class="shoping__checkout">
                        <h5>Détails de la Commande</h5>

                        <!-- Informations générales -->
                        <div class="row">
                            <div class="col-lg-6">
                                <ul>
                                    <li><strong>Date de commande :</strong> <span>{{ commande.created_at|date:"d M Y, H:i" }}</span></li>
                                    <li><strong>Statut de la commande :</strong> 
                                        <span class="{% if commande.statut_commande == StatutCommande.EXPEDIEE %}text-green-600{% else %}text-orange-600{% endif %}">
                                            {{ commande.statut_commande }}
                                        </span>
                                    </li>
                                    <li><strong>Statut de la livraison :</strong> 
                                        <span class="{% if commande.statut_commande == StatutLivraison.LIVREE %}text-green-600{% else %}text-orange-600{% endif %}">
                                            {{ commande.Livraison_id }}
                                        </span>
                                    </li>
                                    <li><strong>Mode de paiement :</strong> <span>{{ commande.paiement.mode.nom }}</span></li>
                                </ul>
                            </div>
                            <div class="col-lg-6">
                                <ul>
                                    <li><strong>Adresse de livraison :</strong> <span>{{ commande.adresse_livraison }}</span></li>
                                    <li><strong>Téléphone :</strong> <span>{{ commande.telephone }}</span></li>
                                </ul>
                            </div>
                        </div>

                        <!-- Liste des produits -->
                        <div class="shoping__cart__table mt-4">
                            <h5>Produits commandés</h5>
                            <table>
                                <thead>
                                    <tr>
                                        <th class="shoping__product">Produit</th>
                                        <th>Prix unitaire</th>
                                        <th>Quantité</th>
                                        <th>Total</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for item in commande.Commande_Produit_ids.all %}
                                        <tr>
                                            <td class="shoping__cart__item">
                                                <img src="{{ item.produit.images.url }}" alt="{{ item.produit.nom }}" style="max-width: 80px;">
                                                <h5>{{ item.produit.nom }}</h5>
                                            </td>
                                            <td class="shoping__cart__price">
                                                {{ item.produit.prix_actuel }} FCFA
                                            </td>
                                            <td>
                                                {{ item.quantite }}
                                            </td>
                                            <td class="shoping__cart__total">
                                                {{ item.prix }} FCFA
                                            </td>
                                        </tr>
                                    {% empty %}
                                        <tr>
                                            <td colspan="4"><h5>Aucun produit dans cette commande</h5></td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>

                        <!-- Résumé des coûts -->
                        <div class="row mt-4">
                            <div class="col-lg-6 offset-lg-6">
                                <div class="shoping__checkout">
                                    <h5>Résumé</h5>
                                    <ul>
                                        <li>Sous-total <span>{{ commande.sous_total }} FCFA</span></li>
                                        <li>Frais de livraison <span>{{ commande.frais_livraison|default:"Gratuit" }}</span></li>
                                        <li><strong>Total</strong> <span>{{ commande.prix }} FCFA</span></li>
                                    </ul>
                                </div>
                            </div>
                        </div>

                        <!-- Actions -->
                        <div class="shoping__cart__btns mt-4">
                            <a href="{% url 'Ecommerce:commandes' %}" class="primary-btn cart-btn">Retour aux commandes</a>
                            {% if commande.statut == 'En attente' %}
                                <a href="{% url 'Ecommerce:commande_cancel' commande.id %}" class="primary-btn cart-btn cart-btn-right">Annuler la commande</a>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>
    <!-- Commande Detail Section End -->
{% endblock %}